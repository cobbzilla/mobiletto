Mobiletto
 =========

 Mobiletto  砖转 驻砖 住 JavaScript, 注 爪驻 砖拽驻 驻爪转 爪 拽.

 # 转
 * [ Mobiletto?](#Why-Mobiletto?)
 * [转 专](#Quick-start)
 * [Mobiletto CLI](#mobiletto-cli)
 * [拽专](#拽专)
 * [转拽](#转拽)
 * [转 ](#Support-and-Funding)
 * [砖砖 住住](#砖砖 住住)
 * [Metadata](#Metadata)
 * [住  驻](#住  驻)
 * [](#Caching)
 * [砖拽祝](#砖拽祝)
 * [爪驻 砖拽驻](#砖拽驻-爪驻)
 * [住 驻转](#Key-rotation)
 * [砖拽  转拽](#砖拽  转拽)
 * [专砖](#)

 # 拽专 转  砖驻 专转
 住 README.md  转专, 爪注转 [hokeylization](https://github.com/cobbzilla/hokeylization), -
 **[ 砖驻 转转 注  Google Translate](https://cloud.google.com/translate/docs/languages)!**

   砖  砖,   拽 砖 转专  !

 [葛 注专转](../ar/README.md)
 [ю 转](../bn/README.md)
 [ 专转](../de/README.md)
 [吼 转](../en/README.md)
 [ 住驻专转](../es/README.md)
 [ 爪专驻转转](../fr/README.md)
 [桂 Hausa](../ha/README.md)
 [ ](../hi/README.md)
 [ 转](../id/README.md)
 [ 拽转](../it/README.md)
 [ 驻转](../ja/README.md)
 [梆 拽专转](../ko/README.md)
 [ Marathi](../mr/README.md)
 [叼 驻转](../pl/README.md)
 [ю 驻专转](../pt/README.md)
 [佛 专住转](../ru/README.md)
 [梆 住](../sw/README.md)
 [叼 Tagalog](../tl/README.md)
 [桂 专拽转](../tr/README.md)
 [叼 专](../ur/README.md)
 [火 转](../vi/README.md)
 [ 住转](../zh/README.md)


 **[ ...  砖驻转 ...](../README.md)**
 ----

 ###  砖 注 注 转专  砖 README?
 转专 住驻爪驻  砖 [README] 拽专 (https://github.com/cobbzilla/mobiletto/blob/master/README.md)
 注砖 转 驻 -- *转拽 转拽 专!*  砖 [拽砖转 砖 -GitHub](https://github.com/cobbzilla/mobiletto/pulls),
   转  专砖  注砖转 转 , [驻转 注](https://github.com/cobbzilla/mobiletto/issues)

 砖专 转 爪专 注 砖 砖 GitHub 注 转专,  注砖:
 *  转 转转 转专 砖 祝 (注转拽/拽 砖专转 转转 砖 驻驻)
 *  转 拽住 拽 砖 (注转拽/拽 驻驻)
 *  转专   住专 --  转专 砖? 驻专 砖专 砖?
 *  爪注 爪注 转专  转专,  爪 砖 注爪 转 拽住 专
 * **转!**

 ##  Mobiletto?

 ### 转专转 注转 住驻拽!
 住驻拽 住 注 砖 砖 砖拽 API  转.   砖驻 "转转 S3"
 注 转转 转.

 砖专 转 专 住驻拽 住 住 注专 驻拽爪 砖,  转 拽 砖专转 -API 砖, 驻拽爪 砖
 注转 转 砖专转 .  砖 注专 拽 爪专, 住驻拽 砖转 驻
 转专 转专 转 住. 专  注  砖 注转 住驻拽!

 Mobiletto 转 驻转专 注 . 注  拽 驻拽爪 砖 -API 砖 mobiletto, 转  拽转
 祝 住驻拽 住 注转 砖砖转 住 砖 驻拽爪 砖 转转 爪专 .

 ### 拽转 拽驻转
   拽 转转  注 60+ 拽转  .
  拽 转   注  砖 砖:
 * 爪驻: 驻注转  砖转转
 *  Redis: 驻注  砖转

 砖  转转  砖拽 驻砖 砖-mobiltto 转 转 专  拽砖专  砖转 砖转砖 ,
  拽砖专  转 驻注  / 爪驻.

 ### 转 
  住  砖 Mobiletto:
 * `s3` : Amazon S3
 * `b2` : Backblaze B2
 * `local` : 注专转 拽爪 拽转

 *转专转 转 住驻拽 住 注 住驻 转拽 专!*

 ## mobiletto-cli
 Mobiletto 注 砖砖 住驻专 注  拽 JavaScript 专.

  注 注 mobiletto 砖专转 驻拽, 砖转砖 -[mobiletto-cli](https://www.npmjs.com/package/mobiletto-cli)

 ## 拽专
 * [mobiletto -GitHub](https://github.com/cobbzilla/mobiletto)
 * [mobiletto -npm](https://www.npmjs.com/package/mobiletto)

 ## 转 
  住 转 驻转 转 拽爪注 拽 驻转. 注转 
 转注砖转 转 砖 砖 专转, 拽转 专转 爪转 专转 转 专转 爪专转.
 专 转 转 注转,   转 注 专转

    住转 转 转 注 专转   注

  转  砖转砖 转 ,    驻 注
 拽 转专 [转专 砖转 专 Patreon](https://www.patreon.com/cobbzilla)

 *转!*

 ## 转拽
 转拽 爪注转 `npm`  `yarn` . 转  专爪 转 专住转 `lite` 砖 转 转  
 拽爪 README 转专:

    npm install mobiletto-lite
    yarn add mobiletto-lite

  转 转 专爪 转 拽爪 README  砖驻, 转拽 转 专住 :

    npm install mobiletto
    yarn add mobiletto

 ## 转 专
  拽爪专 爪注转  转拽 砖 `s3` .

 拽  专抓 转 专   转拽  `b2` '  `local` .

    const storage = require('mobiletto')
    const bucket = await storage.connect('s3', aws_key, aws_secret, {bucket: 'bk'})

    // list objects: returns array of metadata objects
    const listing = await bucket.list()
    const dirList = await bucket.list('some/dir/')
    const everything = await bucket.list('', {recursive: true})

    // write an entire file
    let bytesWritten = await bucket.writeFile('some/path', someBufferOfData)

    // write a file from a stream/generator
    bytesWritten = await bucket.write('some/path', streamOrGenerator)

    // read an entire file
    // returns null if an exception would otherwise be thrown
    const bufferOrNull = await bucket.safeReadFile('some/path')

    // stream-read a file, passing data to callback
    const bytesRead = await bucket.read('some/path', (chunk) => { ...do something with chunk... } )

    // remove a file, returns the path removed
    let removed = await bucket.remove('some/path') // removed is a string

    // remove a directory, returns array of paths removed
    removed = await bucket.remove('some/directory', {recursive: true}) // removed is now an array!

 ----
 ## 砖砖 住住
  专 转专 专转, 爪 转 专 转转 爪注转:

    const { mobiletto } = require('mobiletto')

    // General usage
    const api = await mobiletto(driverName, key, secret, opts)

    // To use 'local' driver:
    // * key: base directory
    // * secret: ignored, can be null
    // * opts object:
    // * readOnly: optional, never change anything on the filesystem; default is false
    // * fileMode: optional, permissions used when creating new files, default is 0600. can be string or integer
    // * dirMode: optional, permissions used when creating new directories, default is 0700. can be string or integer
    const local = await mobiletto('local', '/home/ubuntu/tmp', null, {fileMode: 0o0600, dirMode: '0700'})

    // To use 's3' driver:
    // * key: AWS Access Key ID
    // * secret: AWS Secret Key
    // * opts object:
    // * readOnly: optional, never change anything on the bucket; default is false
    // * bucket: required, name of the S3 bucket
    // * region: optional, the AWS region to communicate with, default is us-east-1
    // * prefix: optional, all read/writes within the S3 bucket will be under this prefix
    // * delimiter: optional, directory delimiter, default is '/' (note: always '/' when encryption is enabled)
    const s3 = await mobiletto('s3', aws_key, aws_secret, {bucket: 'bk', region: 'us-east-1'})

    // To use 'b2' driver:
    // * key: Backblaze Key ID
    // * secret: Backblaze Application Key
    // * opts object:
    // * readOnly: optional, never change anything on the bucket; default is false
    // * bucket: required, the ID (**not the name**) of the B2 bucket
    // * prefix: optional, all read/writes within the B2 bucket will be under this prefix
    // * delimiter: optional, directory delimiter, default is '/' (note: always '/' when encryption is enabled)
    // * partSize: optional, large files will be split into chunks of this size when uploading
    const b3 = await mobiletto('b2', b2_key_id, b2_app_key, {bucket: 'bk', partSize: 10000000})

    // List files
    api.list() // --> returns an array of metadata objects

    // List files recursively
    api.list({ recursive: true })

    // List files in a directory
    const path = 'some/path'
    api.list(path)
    api.list(path, { recursive: true }) // also supports recursive flag

    // Visit files in a directory -- visitor function must be async
    api.list(path, { visitor: myAsyncFunc })
    api.list(path, { visitor: myAsyncFunc, recursive: true })

    // The `list` method throws MobilettoNotFoundError if the path does not exist
    // When you call `safeList` on a non-existent path, it returns an empty array
    api.safeList('/path/that/does/not/exist') // returns []
    
    // Read metadata for a file
    api.metadata(path) // returns metadata object

    // The `metadata` method throws MobilettoNotFoundError if the path does not exist
    // When you call `safeMetadata` on a non-existent path, it returns null
    api.safeMetadata('/tmp/does_not_exist') // returns null
    
    // Read a file
    // Provide a callback that writes the data someplace
    const callback = (chunk) => { ... write chunk somewhere ... }
    api.read(path, callback) // returns count of bytes read

    // Read an entire file at once
    const data = await api.readFile(path) // returns a byte Buffer of the file contents
    
    // Read an entire file at once
    // returns null if an exception would otherwise be thrown
    const bufferOrNull = await bucket.safeReadFile('some/path')

    // Write a file
    // Provide a generator function that yields chunks of data
    const generator = function* () {
      while ( ... more-data-to-return ... ) {
        data = ... load-data ...
        yield data
      }
    }
    local.api(path, generator) // returns count of bytes written

    // Write an entire file at once (convenience method)
    await api.writeFile(path, bufferOrString) // returns count of bytes written

    // Delete a file
    // Quiet param is optional (default false), when set errors will not be thrown if the path does not exist
    // Always returns a value or throws an error.
    // Return value may be a single string of the file removed, or an array of all files removed (driver-dependent)
    const quiet = true
    api.remove(path, {quiet}) // returns single path removed

    // Recursively delete a directory and do it quietly (do not report errors)
    const recursive = true
    const quiet = true
    api.remove(path, {recursive, quiet}) // returns array of paths removed

 ##  转
 驻拽 `metadata` 专  转  注专 注专转 拽爪 转.
 驻 , 注专 专 驻拽 `list` 专砖'  注专 砖 拽  转.

 拽  转 专 :

    {
      "name": "fully/qualified/path/to/file",
      "type": "entry-type",
      "size": size-in-bytes,
      "ctime": creation-time-epoch-millis,
      "mtime": modification-time-epoch-millis
    }

 驻 `type`  转 `file` ' , `dir` ' , `link` '  `special` .

 转 住  转拽, 转 砖驻拽 `list` 专砖'  转专 转  砖转. 驻 `name` 砖 `type`
 爪专 转  转. 驻拽转 `metadata`  转专 转  驻 .

 ## 住  驻
  转  拽祝  砖转砖 驻拽爪转 `connect` :

    const storage = require('mobiletto')
    const opts = {bucket: 'bk', region: 'us-east-1'}
    const s3 = await storage.connect('s3', aws_key, aws_secret, opts)
    const objectData = await s3.readFile('some/path')

 ## 砖专 
 Mobiletto 注   注  <a href="https://redis.io">redis</a> .

 Mobiletto 住 转专 驻注 redis -127.0.0.1:6379

 转  注拽祝  :
 * 专 转 `MOBILETTO_REDIS_HOST` env var, mobilet 转专  拽 专 拽
 * 专 转 -env var `MOBILETTO_REDIS_PORT` , 爪  转砖砖

 Mobiletto 住 转  驻转转 -Redis 砖 注 拽转 `_mobiletto__` . 转  砖转 转 
 注  专转 `MOBILETTO_REDIS_PREFIX` env var.

 转   专   专 注 拽 `opts.redisConfig` :

    const redisConfig = {
        enabled: true, // optional, default is true. if false other props are ignored
        host: '127.0.0.1',
        port: 6379,
        prefix: '_mobiletto__'
    }
    const opts = { redisConfig, bucket: 'bk', region: 'us-east-1' }
    const s3 = await storage.connect('s3', aws_key, aws_secret, opts)

 ###  专爪 住 砖 ?
  砖转: 注专 转 `enabled: false` ' 拽 `opts.redisConfig` 砖 砖转 爪专 转 专 砖.

 驻 砖 , 砖转转 砖专  转砖驻注 专注 注 爪注 转专 拽砖转 住驻转
 住 砖转 转 爪专.

 ### 专 砖专 
 **住 爪驻**: 拽专/转 砖 住 爪驻  专拽 拽爪转 转专  专,
    住驻专转 ( 砖注砖 专 住)   拽专. 砖砖  redis
 转  砖驻专 砖注转 爪注.

  专专转  ,   驻注   砖  专 驻注转 转/住专.
  驻注转 转  住专 转 转 转拽祝  ,  砖拽专  转专 转
 砖 专.

 ###  CLI
  转 砖转砖  CLI  [mobiletto-cli](https://www.npmjs.com/package/mobiletto-cli),
 转  专爪 转  砖 redis 驻注,  砖 砖 专  驻转 砖 驻拽转 `mo` .

 ## 砖拽祝

    // Copy a local filesystem mobiletto to S3
    s3.mirror(local)

    // Mirror a local subdirectory from one mobiletto to an S3 mobiletto, with it's own subdirectory
    local.mirror(s3, 'some/local-folder', 'some/s3-folder')

 驻拽 `mirror` 爪注转 注转拽  驻注转 砖  拽爪 -mobiltto  专.
   驻注 砖 转  砖专 注 专 专 . 驻注 砖 转 驻拽 `mirror`
  住专 转  拽爪 住专.

 注专 专 `mirror`  拽 驻砖 注  住驻专 拽爪 砖爪
 砖拽祝  拽爪  砖转:

    {
      success: count-of-files-mirrored,
      errors: count-of-files-with-errors
    }

 专: 砖拽祝 砖 注专转 转 转 注砖 转   专 专 驻住

 注 住拽 砖 拽专 `mirror`  驻注  转   
 拽专  转.  转   爪专转 砖: " 砖"
  专 砖 拽爪 (转 转 砖拽祝), -"mobiltto " (
 专 砖转 `mirror` )  注专 拽爪 (转 砖拽祝 拽专).

 ## 爪驻 砖拽驻
 驻砖专 爪驻 砖拽驻 爪 拽:

    // Pass encryption parameters
    const encryption = {
      // key is required, must be >= 16 chars
      key: randomstring.generate(128),

      // optional, the default is to derive IV from key
      // when set, IV must be >= 16 chars
      iv: randomstring.generate(128),

      // optional, the default is aes-256-cbc
      algo: 'aes-256-cbc'
    }
    const api = await mobiletto(driverName, key, secret, opts, encryption)

    // Subsequent write operations will encrypt data (client side) when writing
    // Subsequent read operations will decrypt data (client side) when reading

  拽专? 住驻专 驻专转 砖 "住转 住驻专" (专) (爪驻转) 注拽转 专 拽爪 砖爪 
 住驻专 (  住驻专转 -Dirent).
 * 驻拽 `list` 专砖' 拽专转 转 拽爪 转 住驻专转, 驻注转  转 专砖; 专  专  转 注专  拽抓
 * 驻拽转 `list`  注转 转专,  注专 住驻专转 注 住驻专 专 砖 拽爪
 * 驻拽 `write` 转转 拽爪 dirent 住驻专转 dirent 砖  专, 驻 专拽专住;  转 转 拽抓
 * 驻拽转 `write` O(N), 砖专 N = 注拽 专专转 住驻专转
 * 驻拽 `remove` 住专 转 拽抓 -dirent 转, 转  砖  专拽, 驻 专拽专住; 专  住专 转 拽抓
 * 驻拽转 `remove`  专拽专住转 专 拽专 砖 O(N) 转   砖转专 拽转, 砖专 N = 注拽 专专转 住驻专转
 * 驻拽转 `remove` 专拽专住转 注专转 拽爪 转 注拽转 转 转 拽专转

 砖  砖 砖爪驻 爪 拽 驻注转, 专 注 专转  爪 砖专转 爪驻 砖
 住,   驻转, 注  专转 转 住驻专  砖 住驻专转  拽爪 砖  转, 注
 拽爪转 抓,  拽   砖 专专转 住驻专转  转 .
 *注专: 砖转砖  砖 住转   转专.*
 专  注 转 砖转 住驻专转/拽爪    注  转 爪驻 砖
 驻转  驻爪 爪 转 爪驻.   专 砖转!

 ### 爪注 砖专 
 驻注转 住 爪驻 转 转 转. 专砖转 住专转 专拽专住转 转 转 转 .
 砖专  爪注转 redis 注专转 ,  砖  砖 砖祝  转  住专.

 ## 住 驻转
 爪专 Mobiletto 注 驻转 砖 砖, 专  砖拽祝 转 转 砖 转:

    const storage = require('mobiletto')

    const oldEncryption = { key: .... }
    const oldStorage = await storage.connect('s3', aws_key, aws_secret, {bucket: 'bk', region: 'us-east-1'}, oldEncryption)

    const newEncryption = { key: .... }
    const newStorage = await storage.connect('s3', aws_key, aws_secret, {bucket: 'zz', region: 'us-east-1'}, newEncryption)

    newStorage.mirror(oldStorage) // if oldStorage is very large, this may take a looooooong time...

 ## 砖拽  转拽
  转拽   拽抓 JS 砖爪 驻拽爪转 'storageClient' 注 转 :

    function storageClient (key, secret, opts)

 * `key` : 专转, 驻转 -API 砖 (注专  转拽 `local`  住驻专转 住住)
 * `secret` : 专转, 住 -API 砖 (转 砖 注专  转拽 `local` )
 * `opts` : 拽, 驻    转拽:
 * 注专 `local` , `fileMode` `dirMode` 拽注 爪 爪专 拽爪 爪专 住驻专转 砖转
 * 注专 `s3` , 驻 `bucket` 专砖. 驻 驻爪 :
    * `region`: the S3 region, default is us-east-1
    * `prefix`: a prefix to prepend to all S3 paths, default is the empty string
    * `delimiter`: the directory delimiter, default is '/'

 拽 砖驻拽爪 storageClient 专  专 转 驻拽爪转 转:

    // Test the driver before using, ensure proper configuration
    async testConfig ()

    // List files in path (or from base-directory)
    // If recursive is true, list recursively
    // If visitor is defined, it will be an async function. await the visitor function on each file found
    // Otherwise, perform the listing and return an array of objects
    async list (path, recursive = false, visitor = null) // path may be omitted
    
    // Read metadata for a path
    async metadata (path)
    
    // Read a file
    // callback receives a chunk of data. endCallback is called at end-of-stream
    async read (path, callback, endCallback = null)

    // Write a file
    // driver must be able to handle a generator or a stream
    async write (path, generatorOrReadableStream)

    // Remove a file, or recursively delete a directory
    // returns a string of a single path removed, or an array of multiple paths removed
    async remove (path, recursive = false, quiet = false)

 ## 专砖
 Mobiletto 砖转砖 住驻专转 专砖 砖 [winston](https://www.npmjs.com/package/winston).

  **** 转 拽爪 注转 砖,  **注 **  驻转转, 住转,
   注 专 注 转爪专转 专.

 ### 专转 
 砖转砖 砖转 住 `MOBILETTO_LOG_LEVEL`  专 转 专转 , 爪注转 
 `npm` 专转 -[https://www.npmjs.com/package/winston#logging-levels](https://www.npmjs.com/package/winston#logging-levels)

 专转 专专转   `error` . 专 转 转专  `silly` ,   专注 mobiletto
  转专 专转 转转 `debug`

    MOBILETTO_LOG_LEVEL=silly # maximum logs!

 ### 拽抓 
 专专转 , 专 转 住祝.  砖  拽抓, 专 转 `MOBILETTO_LOG_FILE`
 砖转 住. 注转 住 拽抓,   转 转专 住祝.

    MOBILETTO_LOG_FILE=/var/my_mobiletto_log

  转 转 专砖:

    MOBILETTO_LOG_FILE=/dev/null

</pre>
