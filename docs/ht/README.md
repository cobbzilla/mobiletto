Mobiletto
 =========

 Mobiletto se yon kouch abstraksyon depo JavaScript, ak si ou vle chifreman transparan bÃ² kliyan.

 # Kontni
 * [Poukisa Mobiletto?](#Poukisa-Mobiletto?)
 * [KÃ²manse rapid](#KÃ²manse rapid)
 * [Mobiletto CLI](#mobiletto-cli)
 * [Sous](#Sous)
 * [Itilizasyon debaz](#Itilizasyon debaz)
 * [Metadone](#Metadone)
 * [AltÃ¨natif enpÃ²te style](#AltÃ¨natif-enpÃ²te-style)
 * [Caching](#Caching)
 * [Mirroring](#Mirroring)
 * [Transparan chifreman](#Transparent-chiffrement)
 * [Wotasyon kle](#Kle-wotasyon)
 * [KoÃ²done chofÃ¨](#Driver-koÃ²done)
 * [Logging](#Logging)

 # Li sa nan yon lÃ²t lang
 Dokiman README.md sa a te tradui, atravÃ¨ [hokeylization](https://github.com/cobbzilla/hokeylization), nan
 **[chak lang Google Translate sipÃ²te](https://cloud.google.com/translate/docs/languages)!**

 Mwen sÃ¨ten li pa pafÃ¨, men mwen espere ke li pi bon pase anyen!

 [ðŸ‡¸ðŸ‡¦ Arabe](../ar/README.md)
 [ðŸ‡§ðŸ‡© Bengali](../bn/README.md)
 [ðŸ‡©ðŸ‡ª Alman](../de/README.md)
 [ðŸ‡ºðŸ‡¸ Angle](../en/README.md)
 [ðŸ‡ªðŸ‡¸ PanyÃ²l](../es/README.md)
 [ðŸ‡«ðŸ‡· Franse](../fr/README.md)
 [ðŸ‡¹ðŸ‡© Hausa](../ha/README.md)
 [ðŸ‡®ðŸ‡³ Hindi](../hi/README.md)
 [ðŸ‡®ðŸ‡© Endonezyen](../id/README.md)
 [ðŸ‡®ðŸ‡¹ Italyen](../it/README.md)
 [ðŸ‡¯ðŸ‡µ JaponÃ¨](../ja/README.md)
 [ðŸ‡°ðŸ‡· Koreyen](../ko/README.md)
 [ðŸ‡®ðŸ‡³ Maranthi](../mr/README.md)
 [ðŸ‡µðŸ‡± PolonÃ¨](../pl/README.md)
 [ðŸ‡§ðŸ‡· PÃ²tigÃ¨](../pt/README.md)
 [ðŸ‡·ðŸ‡º Ris](../ru/README.md)
 [ðŸ‡°ðŸ‡ª Swahili](../sw/README.md)
 [ðŸ‡µðŸ‡­ Tagalog](../tl/README.md)
 [ðŸ‡¹ðŸ‡· Tik](../tr/README.md)
 [ðŸ‡µðŸ‡° Oudou](../ur/README.md)
 [ðŸ‡»ðŸ‡³ Vyetnamyen](../vi/README.md)
 [ðŸ‡¨ðŸ‡³ Chinwa](../zh/README.md)


 **[ðŸ“š ... Tout Lang ...](../README.md)**
 ----

 ### Ãˆske gen yon pwoblÃ¨m ak tradiksyon README sa a?
 Tradiksyon patikilye sa a orijinal [README](https://github.com/cobbzilla/mobiletto/blob/master/README.md)
 ka gen defo -- *koreksyon yo trÃ¨ akeyi!* Tanpri voye yon [pull demand sou GitHub](https://github.com/cobbzilla/mobiletto/pulls),
 oswa si w pa konfÃ²tab pou w fÃ¨ sa, [louvri yon pwoblÃ¨m](https://github.com/cobbzilla/mobiletto/issues)

 LÃ¨ ou kreye yon nouvo pwoblÃ¨m GitHub sou yon tradiksyon, tanpri fÃ¨:
 * enkli URL paj la (kopi/kole nan ba adrÃ¨s navigatÃ¨ a)
 * enkli tÃ¨ks egzak ki mal (kopi/kole nan navigatÃ¨ a)
 * Tanpri dekri sa ki mal -- Ã¨ske tradiksyon an pa kÃ²rÃ¨k? se fÃ²ma a kase yon jan kanmenm?
 * Tanpri ofri yon sijesyon pou yon pi bon tradiksyon, oswa ki jan tÃ¨ks la ta dwe byen fÃ²ma
 * **MÃ¨si!**

 ## Poukisa Mobiletto?

 ### Orevwa machann lock-in!
 DivÃ¨s kalite founisÃ¨ depo nwaj yo gen API enkonpatib. Menm moun ki fÃ¨ efÃ² pou "S3 konpatibilite"
 gen konpÃ²tman idiosinkratik.

 LÃ¨ w chwazi yon machann depo patikilye pou aplikasyon w lan, si w kode dirÃ¨kteman nan API yo, aplikasyon w lan
 se kounye a depann sou sÃ¨vis sa a. KÃ²m tan ap pase ak kÃ²d akimile, chanje fournisseurs vin
 de pli zan pli insoutenab. Byenveni nan mond lan amizan nan fÃ¨men vandÃ¨!

 Mobiletto te fÃ¨t pou rezoud pwoblÃ¨m sa a. LÃ¨ w kode aplikasyon w lan nan API mobiletto a, ou ka fasilman
 chanje founisÃ¨ depo epi konnen ke kouch depo app ou a ap konpÃ²te menm jan an.

 ### TÃ¨s vaste
 Tout chofÃ¨ yo teste pou konpÃ²tman ki idantik ak plis pase 60 tÃ¨s pou chak chofÃ¨.
 Nou teste tout chofÃ¨ ak tout konbinezon de:
 * Chifre: tou de aktive ak enfim
 * Redis kachÃ¨t: tou de aktive ak enfim

 ApwÃ²ch sa a ban nou lapÃ¨-of-espri ke mobiletto pral konpÃ²te menm jan kÃ¨lkeswa chofÃ¨ ou itilize,
 ak kÃ¨lkeswa si ou pÃ¨mÃ¨t kachÃ¨t ak/oswa chifreman.

 ### SipÃ² chofÃ¨
 ChofÃ¨ depo Mobiletto aktyÃ¨l yo:
 * `s3` : Amazon S3
 * `b2` : Backblaze B2
 * `local` : sistÃ¨m dosye lokal

 *Kontribisyon pou sipÃ²te plis founisÃ¨ depo nwaj yo trÃ¨ akeyi!*

 ## mobiletto-cli
 Mobiletto fÃ¨t pou itilize kÃ²m yon bibliyotÃ¨k pa lÃ²t kÃ²d JavaScript.

 Pou travay ak mobiletto nan liy lÃ²d la, sÃ¨vi ak [mobiletto-cli](https://www.npmjs.com/package/mobiletto-cli)

 ## Sous
 * [mobiletto sou GitHub](https://github.com/cobbzilla/mobiletto)
 * [mobiletto sou npm](https://www.npmjs.com/package/mobiletto)

 ## KÃ²manse rapid
 Yon egzanp kout lÃ¨ l sÃ¨vi avÃ¨k chofÃ¨ mobiletto `s3` .

 KÃ²d sa a ta kouri menm si chofÃ¨ a te `b2` oswa `local` .

    const storage = require('mobiletto')
    const bucket = await storage.connect('s3', aws_key, aws_secret, {bucket: 'bk'})

    // list objects: returns array of metadata objects
    const listing = await bucket.list()
    const dirList = await bucket.list('some/dir/')
    const everything = await bucket.list('', {recursive: true})

    // write an entire file
    let bytesWritten = await bucket.writeFile('some/path', someBufferOfData)

    // write a file from a stream/generator
    bytesWritten = await bucket.write('some/path', streamOrGenerator)

    // read an entire file
    // returns null if an exception would otherwise be thrown
    const bufferOrNull = await bucket.safeReadFile('some/path')

    // stream-read a file, passing data to callback
    const bytesRead = await bucket.read('some/path', (chunk) => { ...do something with chunk... } )

    // remove a file, returns the path removed
    let removed = await bucket.remove('some/path') // removed is a string

    // remove a directory, returns array of paths removed
    removed = await bucket.remove('some/directory', {recursive: true}) // removed is now an array!

 ----
 ## Itilizasyon debaz
 Yon egzanp pi plis vaste, ki montre pi fÃ² nan karakteristik yo ofri:

    const { mobiletto } = require('mobiletto')

    // General usage
    const api = await mobiletto(driverName, key, secret, opts)

    // To use 'local' driver:
    // * key: base directory
    // * secret: ignored, can be null
    // * opts object:
    // * readOnly: optional, never change anything on the filesystem; default is false
    // * fileMode: optional, permissions used when creating new files, default is 0600. can be string or integer
    // * dirMode: optional, permissions used when creating new directories, default is 0700. can be string or integer
    const local = await mobiletto('local', '/home/ubuntu/tmp', null, {fileMode: 0o0600, dirMode: '0700'})

    // To use 's3' driver:
    // * key: AWS Access Key ID
    // * secret: AWS Secret Key
    // * opts object:
    // * readOnly: optional, never change anything on the bucket; default is false
    // * bucket: required, name of the S3 bucket
    // * region: optional, the AWS region to communicate with, default is us-east-1
    // * prefix: optional, all read/writes within the S3 bucket will be under this prefix
    // * delimiter: optional, directory delimiter, default is '/' (note: always '/' when encryption is enabled)
    const s3 = await mobiletto('s3', aws_key, aws_secret, {bucket: 'bk', region: 'us-east-1'})

    // To use 'b2' driver:
    // * key: Backblaze Key ID
    // * secret: Backblaze Application Key
    // * opts object:
    // * readOnly: optional, never change anything on the bucket; default is false
    // * bucket: required, the ID (**not the name**) of the B2 bucket
    // * prefix: optional, all read/writes within the B2 bucket will be under this prefix
    // * delimiter: optional, directory delimiter, default is '/' (note: always '/' when encryption is enabled)
    // * partSize: optional, large files will be split into chunks of this size when uploading
    const b3 = await mobiletto('b2', b2_key_id, b2_app_key, {bucket: 'bk', partSize: 10000000})

    // List files
    api.list() // --> returns an array of metadata objects

    // List files recursively
    api.list({ recursive: true })

    // List files in a directory
    const path = 'some/path'
    api.list(path)
    api.list(path, { recursive: true }) // also supports recursive flag

    // Visit files in a directory -- visitor function must be async
    api.list(path, { visitor: myAsyncFunc })
    api.list(path, { visitor: myAsyncFunc, recursive: true })

    // The `list` method throws MobilettoNotFoundError if the path does not exist
    // When you call `safeList` on a non-existent path, it returns an empty array
    api.safeList('/path/that/does/not/exist') // returns []
    
    // Read metadata for a file
    api.metadata(path) // returns metadata object

    // The `metadata` method throws MobilettoNotFoundError if the path does not exist
    // When you call `safeMetadata` on a non-existent path, it returns null
    api.safeMetadata('/tmp/does_not_exist') // returns null
    
    // Read a file
    // Provide a callback that writes the data someplace
    const callback = (chunk) => { ... write chunk somewhere ... }
    api.read(path, callback) // returns count of bytes read

    // Read an entire file at once
    const data = await api.readFile(path) // returns a byte Buffer of the file contents
    
    // Read an entire file at once
    // returns null if an exception would otherwise be thrown
    const bufferOrNull = await bucket.safeReadFile('some/path')

    // Write a file
    // Provide a generator function that yields chunks of data
    const generator = function* () {
      while ( ... more-data-to-return ... ) {
        data = ... load-data ...
        yield data
      }
    }
    local.api(path, generator) // returns count of bytes written

    // Write an entire file at once (convenience method)
    await api.writeFile(path, bufferOrString) // returns count of bytes written

    // Delete a file
    // Quiet param is optional (default false), when set errors will not be thrown if the path does not exist
    // Always returns a value or throws an error.
    // Return value may be a single string of the file removed, or an array of all files removed (driver-dependent)
    const quiet = true
    api.remove(path, {quiet}) // returns single path removed

    // Recursively delete a directory and do it quietly (do not report errors)
    const recursive = true
    const quiet = true
    api.remove(path, {recursive, quiet}) // returns array of paths removed

 ## Metadata
 KÃ²mand `metadata` la retounen metadata sou yon sÃ¨l antre sistÃ¨m fichye.
 Menm jan an tou, valÃ¨ retounen nan lÃ²d `list` la se yon etalaj de objÃ¨ metadata.

 Yon objÃ¨ metadata sanble sa a:

    {
      "name": "fully/qualified/path/to/file",
      "type": "entry-type",
      "size": size-in-bytes,
      "ctime": creation-time-epoch-millis,
      "mtime": modification-time-epoch-millis
    }

 Pwopriyete `type` a kapab `file` , `dir` , `link` , oswa `special` .

 Tou depan de kalite chofÃ¨ a, yon lÃ²d `list` ka pa retounen tout jaden yo. Pwopriyete `name` ak `type`
 ta dwe toujou prezan. Yon lÃ²d `metadata` ki vin apre ap retounen tout pwopriyete ki disponib yo.

 ## AltÃ¨ne style enpÃ²te
 EnpÃ²te modil totalman an epi sÃ¨vi ak fonksyon `connect` :

    const storage = require('mobiletto')
    const opts = {bucket: 'bk', region: 'us-east-1'}
    const s3 = await storage.connect('s3', aws_key, aws_secret, opts)
    const objectData = await s3.readFile('some/path')

 ## Cache
 Mobiletto travay pi byen ak yon kachÃ¨t <a href="https://redis.io">redis</a> .

 Mobiletto pral eseye konekte ak yon egzanp redis sou 127.0.0.1:6379

 Ou ka depase youn nan sa yo:
 * Mete `MOBILETTO_REDIS_HOST` env var, mobiletto konekte isit la olye de localhost
 * Mete `MOBILETTO_REDIS_PORT` env var, pÃ² sa a pral itilize

 Mobiletto pral estoke tout kle redis li yo ak prefiks `_mobiletto__` . Ou ka chanje sa
 pa mete `MOBILETTO_REDIS_PREFIX` env var.

 Ou kapab tou mete kach pou chak koneksyon ak objÃ¨ `opts.redisConfig` :

    const redisConfig = {
        enabled: true, // optional, default is true. if false other props are ignored
        host: '127.0.0.1',
        port: 6379,
        prefix: '_mobiletto__'
    }
    const opts = { redisConfig, bucket: 'bk', region: 'us-east-1' }
    const s3 = await storage.connect('s3', aws_key, aws_secret, opts)

 ### Ou pa vle redis kachÃ¨t?
 Pou enfim: pase `enabled: false` nan objÃ¨ `opts.redisConfig` ou lÃ¨ ou etabli koneksyon ou.

 Jan yo diskite pi ba a, enfimite kachÃ¨t pral gen yon efÃ¨ negatif sou pÃ¨fÃ²mans ak antrene plis demann
 nan depo ke ou reyÃ¨lman bezwen.

 ### Kache konsÃ¨y
 **Depo kode**: lekti/ekri depo kode se sÃ¨lman yon ti kras pi dousman pase nÃ²mal,
 men navige nan repÃ¨rtwar (ki kÃ¨k bagay fÃ¨) se jistis chÃ¨. SÃ¨vi ak yon kachÃ¨t redis
 pral ba ou yon ogmantasyon siyifikatif pÃ¨fÃ²mans.

 KachÃ¨t default la an sekirite, men li pa fÃ¨ byen si ou gen anpil operasyon ekri/retire.
 NenpÃ²t operasyon ekri oswa retire invalid kachÃ¨t la tout antye, asire lekti ki vin apre yo pral wÃ¨
 dÃ¨nye chanjman.

 ### CLI zouti
 Si w ap itilize yon zouti CLI tankou [mobiletto-cli](https://www.npmjs.com/package/mobiletto-cli),
 ou pral definitivman vle redis kachÃ¨t la aktive, kÃ²m li dire atravÃ¨ envokasyon nan lÃ²d `mo` .

 ## Mirroring

    // Copy a local filesystem mobiletto to S3
    s3.mirror(local)

    // Mirror a local subdirectory from one mobiletto to an S3 mobiletto, with it's own subdirectory
    local.mirror(s3, 'some/local-folder', 'some/s3-folder')

 `mirror` la fÃ¨ yon kopi yon sÃ¨l fwa nan tout dosye soti nan yon mobiltto nan yon lÃ²t.
 Li pa kouri okenn pwosesis pou kenbe glas la sou tan. Kouri kÃ²mand `mirror` ankÃ²
 pou senkronize nenpÃ²t ki dosye ki manke.

 ValÃ¨ retounen nan `mirror` se yon objÃ¨ senp ak kontÃ¨ pou konbyen dosye yo te reyisi
 reflete ak konbyen dosye ki te gen erÃ¨:

    {
      success: count-of-files-mirrored,
      errors: count-of-files-with-errors
    }

 AVÃˆTISMAN: Reflete seri gwo done yo ka pran anpil tan ak Pleasant-entansif

 AvÃ¨k semantik apÃ¨l `mirror` li pafwa kapab konfizyon pou w konprann kiyÃ¨s ki la
 lektÃ¨ ak ki moun ki ekriven an. Imajine li tankou yon deklarasyon devwa: "mobiletto nan men gÃ²ch"
 se bagay yo te plase nan (replike done ekri), ak "mobiletto adwat" (la
 agiman nan metÃ²d `mirror` ) se valÃ¨ yo te bay (done yo miroir li).

 ## Chifre transparan
 PÃ¨mÃ¨t transparan chifreman bÃ² kliyan:

    // Pass encryption parameters
    const encryption = {
      // key is required, must be >= 16 chars
      key: randomstring.generate(128),

      // optional, the default is to derive IV from key
      // when set, IV must be >= 16 chars
      iv: randomstring.generate(128),

      // optional, the default is aes-256-cbc
      algo: 'aes-256-cbc'
    }
    const api = await mobiletto(driverName, key, secret, opts, encryption)

    // Subsequent write operations will encrypt data (client side) when writing
    // Subsequent read operations will decrypt data (client side) when reading

 Sak ap pase? Yon separe "antre anyÃ¨" (direksyon) anyÃ¨ (chiffre) swiv ki fichye yo nan sa
 anyÃ¨ (aka anyÃ¨ dirent).
 * `list` la li dosye yo antre anyÃ¨, dekripte chak chemen ki nan lis la; LÃ¨ sa a, retounen metadata pou chak dosye
 * `list` yo pi efikas, espesyalman pou anyÃ¨ ki gen yon gwo kantite fichye
 * `write` ekri fichye dirent nan anyÃ¨ diret chak paran, yon fason rekursif; LÃ¨ sa a, ekri fichye a
 * `write` yo pral fÃ¨ O(N) ekri, ak N = pwofondÃ¨ nan yerachi anyÃ¨ a.
 * `remove` retire fichye dirent ki koresponn lan, ak paran li si li vid, yon fason repetitif; LÃ¨ sa a, retire dosye a
 * `remove` ki pa rekursif yo pral fÃ¨ lekti O(N) ak potansyÃ¨lman anpil efase, ak N = pwofondÃ¨ nan yerachi anyÃ¨ a.
 * `remove` repetitif sou sistÃ¨m fichye gwo ak gwo twou san fon ka chÃ¨

 Remake byen ke menm avÃ¨k chifreman bÃ² kliyan pÃ¨mÃ¨t, yon advÃ¨sÃ¨ ki gen yon vizibilite konplÃ¨ sou bÃ² sÃ¨vÃ¨ chiffres ou.
 depo, menm san kle a, ka toujou wÃ¨ kantite total anyÃ¨ ak konbyen fichye yo nan chak, ak
 kÃ¨k efÃ², dekouvri kÃ¨k oswa tout estrikti an jeneral nan yerachi anyÃ¨ a.
 *Remak: SÃ¨vi ak yon estrikti relativman plat pou pi bon sekirite.*
 AdvÃ¨sÃ¨ a pa ta konnen non anyÃ¨ / fichye yo sof si yo te konnen tou chifreman ou
 kle oswa te gen otreman avÃ¨k siksÃ¨ fann chifreman an. LÃ¨ sa a, tout parye yo koupe!

 ### PÃ¨fÃ²mans ak kachÃ¨t
 Operasyon sou depo chiffres kapab dousman. Lis rekursif ak retire ka trÃ¨ dousman.
 Cache atravÃ¨ redis ede anpil, men sonje ke kachÃ¨t la vide sou nenpÃ²t ki ekri oswa retire.

 ## Wotasyon kle
 Kreye yon mobiletto ak nouvo kle ou a, epi reflete ansyen done yo nan li:

    const storage = require('mobiletto')

    const oldEncryption = { key: .... }
    const oldStorage = await storage.connect('s3', aws_key, aws_secret, {bucket: 'bk', region: 'us-east-1'}, oldEncryption)

    const newEncryption = { key: .... }
    const newStorage = await storage.connect('s3', aws_key, aws_secret, {bucket: 'zz', region: 'us-east-1'}, newEncryption)

    newStorage.mirror(oldStorage) // if oldStorage is very large, this may take a looooooong time...

 ## KoÃ²done chofÃ¨
 Yon chofÃ¨ se nenpÃ²t fichye JS ki ekspÃ²te yon fonksyon 'storageClient' ak siyati sa a:

    function storageClient (key, secret, opts)

 * `key` : yon kÃ²d, kle API ou (pou chofÃ¨ `local` sa a se anyÃ¨ debaz la)
 * `secret` : yon kÃ²d, sekrÃ¨ API ou (yo ka omisyon pou chofÃ¨ `local` )
 * `opts` : yon objÃ¨, pwopriyete yo se pou chak chofÃ¨:
 * Pou `local` , pwopriyete `fileMode` ak `dirMode` detÃ¨mine fason yo kreye nouvo fichye ak anyÃ¨.
 * Pou `s3` , pwopriyete a `bucket` obligatwa. Pwopriyete opsyonÃ¨l yo se:
    * `region`: the S3 region, default is us-east-1
    * `prefix`: a prefix to prepend to all S3 paths, default is the empty string
    * `delimiter`: the directory delimiter, default is '/'

 ObjÃ¨ ke fonksyon storageClient retounen dwe defini fonksyon sa yo:

    // Test the driver before using, ensure proper configuration
    async testConfig ()

    // List files in path (or from base-directory)
    // If recursive is true, list recursively
    // If visitor is defined, it will be an async function. await the visitor function on each file found
    // Otherwise, perform the listing and return an array of objects
    async list (path, recursive = false, visitor = null) // path may be omitted
    
    // Read metadata for a path
    async metadata (path)
    
    // Read a file
    // callback receives a chunk of data. endCallback is called at end-of-stream
    async read (path, callback, endCallback = null)

    // Write a file
    // driver must be able to handle a generator or a stream
    async write (path, generatorOrReadableStream)

    // Remove a file, or recursively delete a directory
    // returns a string of a single path removed, or an array of multiple paths removed
    async remove (path, recursive = false, quiet = false)

 ## Enregistrement
 Mobiletto sÃ¨vi ak bibliyotÃ¨k ki anrejistre [winston](https://www.npmjs.com/package/winston).

 Jounal yo **ap** gen ladann chemen fichye yo ak mesaj erÃ¨, men yo p ap **pa janm** genyen kle, sekrÃ¨,
 oswa nenpÃ²t lÃ²t enfÃ²masyon konfigirasyon koneksyon.

 ### Log nivo
 SÃ¨vi ak varyab anviwÃ²nman `MOBILETTO_LOG_LEVEL` pou mete nivo mÃ²so a, lÃ¨ l sÃ¨vi avÃ¨k youn
 nan nivo `npm` yo defini nan [https://www.npmjs.com/package/winston#logging-levels](https://www.npmjs.com/package/winston#logging-levels)

 Nivo default la se `error` . Nivo ki pi pwolib la se `silly` , byenke kounye a mobiletto
 pa konekte nan nivo anba a `debug`

    MOBILETTO_LOG_LEVEL=silly # maximum logs!

 ### Log dosye
 Pa default, logger la ekri nan konsole a. Pou voye mÃ²so bwa nan yon dosye, mete `MOBILETTO_LOG_FILE`
 anviwÃ²nman varyab. LÃ¨ w ap antre nan yon dosye, mÃ²so bwa yo p ap ekri sou konsole a ankÃ².

    MOBILETTO_LOG_FILE=/var/my_mobiletto_log

 Pou fÃ¨men enregistrement:

    MOBILETTO_LOG_FILE=/dev/null

</pre>
