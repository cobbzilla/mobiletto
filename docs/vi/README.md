Mobiletto
 =========

 Mobiletto l√† m·ªôt l·ªõp tr·ª´u t∆∞·ª£ng l∆∞u tr·ªØ JavaScript, v·ªõi m√£ h√≥a ph√≠a m√°y kh√°ch trong su·ªët t√πy ch·ªçn.

 # N·ªôi dung
 * [T·∫°i sao l·∫°i l√† Mobiletto?](# T·∫°i sao-Mobiletto?)
 * [B·∫Øt ƒë·∫ßu nhanh](# B·∫Øt ƒë·∫ßu nhanh)
 * [Mobiletto CLI](# mobiletto-cli)
 * [Ngu·ªìn](# Ngu·ªìn)
 * [C√†i ƒë·∫∑t](# C√†i ƒë·∫∑t)
 * [H·ªó tr·ª£ v√† T√†i tr·ª£](# H·ªó tr·ª£ v√† T√†i tr·ª£)
 * [C√°ch s·ª≠ d·ª•ng c∆° b·∫£n](# C√°ch s·ª≠ d·ª•ng c∆° b·∫£n)
 * [Si√™u d·ªØ li·ªáu](# Si√™u d·ªØ li·ªáu)
 * [Ki·ªÉu nh·∫≠p thay th·∫ø](# Ki·ªÉu nh·∫≠p thay th·∫ø)
 * [B·ªô nh·ªõ ƒë·ªám](# b·ªô nh·ªõ ƒë·ªám)
 * [Ph·∫£n chi·∫øu](# Ph·∫£n chi·∫øu)
 * [M√£ h√≥a minh b·∫°ch](# M√£ h√≥a minh b·∫°ch)
 * [Xoay ph√≠m](# Xoay ph√≠m)
 * [Giao di·ªán tr√¨nh ƒëi·ªÅu khi·ªÉn](# Giao di·ªán tr√¨nh ƒëi·ªÅu khi·ªÉn)
 * [Ghi nh·∫≠t k√Ω](# Ghi nh·∫≠t k√Ω)

 # ƒê·ªçc s√°ch n√†y b·∫±ng ng√¥n ng·ªØ kh√°c
 T√†i li·ªáu README.md n√†y ƒë√£ ƒë∆∞·ª£c d·ªãch, qua [hokeyption](https://github.com/cobbzilla/hokeyption), sang
 ** [m·ªçi ng√¥n ng·ªØ ƒë∆∞·ª£c Google D·ªãch h·ªó tr·ª£](https://cloud.google.com/translate/docs/languages)! **

 T√¥i ch·∫Øc ch·∫Øn r·∫±ng n√≥ kh√¥ng ho√†n h·∫£o, nh∆∞ng t√¥i hy v·ªçng n√≥ c√≤n h∆°n kh√¥ng!

 [üá∏üá¶ ti·∫øng ·∫¢ R·∫≠p](docs / ar / README.md)
 [üáßüá© Ti·∫øng Bengali](docs / bn / README.md)
 [üá©üá™ ti·∫øng ƒê·ª©c](docs / de / README.md)
 [üá∫üá∏ Ti·∫øng Anh](docs / en / README.md)
 [üá™üá∏ Ti·∫øng T√¢y Ban Nha](docs / es / README.md)
 [üá´üá∑ Ti·∫øng Ph√°p](docs / fr / README.md)
 [üáπüá© Hausa](docs / ha / README.md)
 [üáÆüá≥ Hindi](docs / hi / README.md)
 [üáÆüá© ti·∫øng Indonesia](docs / id / README.md)
 [üáÆüáπ Ti·∫øng √ù](docs / it / README.md)
 [üáØüáµ Ti·∫øng Nh·∫≠t](docs / ja / README.md)
 [üá∞üá∑ Ti·∫øng H√†n](docs / ko / README.md)
 [üáÆüá≥ Maranthi](docs / mr / README.md)
 [üáµüá± Ti·∫øng Ba Lan](docs / pl / README.md)
 [üáßüá∑ ti·∫øng B·ªì ƒê√†o Nha](docs / pt / README.md)
 [üá∑üá∫ ti·∫øng Nga](docs / ru / README.md)
 [üá∞üá™ Swahili](docs / sw / README.md)
 [üáµüá≠ Tagalog](docs / tl / README.md)
 [üáπüá∑ ti·∫øng Th·ªï Nhƒ© K·ª≥](docs / tr / README.md)
 [üáµüá∞ Urdu](docs / ur / README.md)
 [üáªüá≥ Ti·∫øng Vi·ªát](docs / vi / README.md)
 [üá®üá≥ Ti·∫øng Trung](docs / zh / README.md)


 ** [üìö ... T·∫•t c·∫£ ng√¥n ng·ªØ ...](docs / README.md) **
 ----

 ### C√≥ s·ª± c·ªë v·ªõi b·∫£n d·ªãch README n√†y kh√¥ng?
 B·∫£n d·ªãch c·ª• th·ªÉ n√†y c·ªßa b·∫£n g·ªëc [README](https://github.com/cobbzilla/mobiletto/blob/master/README.md)
 c√≥ th·ªÉ c√≥ sai s√≥t - * r·∫•t hoan ngh√™nh vi·ªác s·ª≠a ch·ªØa! * Vui l√≤ng g·ª≠i [y√™u c·∫ßu k√©o tr√™n GitHub](https://github.com/cobbzilla/mobiletto/pulls),
 ho·∫∑c n·∫øu b·∫°n kh√¥ng tho·∫£i m√°i khi l√†m ƒëi·ªÅu ƒë√≥, h√£y [m·ªü s·ª± c·ªë](https://github.com/cobbzilla/mobiletto/issues)

 Khi b·∫°n t·∫°o m·ªôt v·∫•n ƒë·ªÅ GitHub m·ªõi v·ªÅ b·∫£n d·ªãch, vui l√≤ng th·ª±c hi·ªán:
 * bao g·ªìm URL c·ªßa trang (sao ch√©p / d√°n t·ª´ thanh ƒë·ªãa ch·ªâ tr√¨nh duy·ªát)
 * bao g·ªìm vƒÉn b·∫£n ch√≠nh x√°c b·ªã sai (sao ch√©p / d√°n t·ª´ tr√¨nh duy·ªát)
 * vui l√≤ng m√¥ t·∫£ nh·ªØng g√¨ l√† sai - b·∫£n d·ªãch kh√¥ng ch√≠nh x√°c? ƒë·ªãnh d·∫°ng c√≥ b·ªã h·ªèng b·∫±ng c√°ch n√†o ƒë√≥ kh√¥ng?
 * vui l√≤ng ƒë∆∞a ra g·ª£i √Ω v·ªÅ b·∫£n d·ªãch t·ªët h∆°n ho·∫∑c c√°ch vƒÉn b·∫£n ph·∫£i ƒë∆∞·ª£c ƒë·ªãnh d·∫°ng ƒë√∫ng
 * **C·∫£m ∆°n b·∫°n!**

 ## T·∫°i sao Mobiletto?

 ### T·∫°m bi·ªát kh√≥a c·ª≠a nh√† cung c·∫•p!
 C√°c nh√† cung c·∫•p d·ªãch v·ª• l∆∞u tr·ªØ ƒë√°m m√¢y kh√°c nhau c√≥ c√°c API kh√¥ng t∆∞∆°ng th√≠ch. Ngay c·∫£ nh·ªØng ng∆∞·ªùi ph·∫•n ƒë·∫•u cho "kh·∫£ nƒÉng t∆∞∆°ng th√≠ch S3"
 c√≥ nh·ªØng h√†nh vi mang phong c√°ch ri√™ng.

 Khi b·∫°n ch·ªçn m·ªôt nh√† cung c·∫•p b·ªô nh·ªõ c·ª• th·ªÉ cho ·ª©ng d·ª•ng c·ªßa m√¨nh, n·∫øu b·∫°n vi·∫øt m√£ tr·ª±c ti·∫øp t·ªõi API c·ªßa h·ªç, ·ª©ng d·ª•ng c·ªßa b·∫°n
 b√¢y gi·ªù ph·ª• thu·ªôc v√†o d·ªãch v·ª• ƒë√≥. Khi th·ªùi gian tr√¥i qua v√† m√£ t√≠ch l≈©y, vi·ªác thay ƒë·ªïi nh√† cung c·∫•p s·∫Ω tr·ªü th√†nh
 ng√†y c√†ng kh√¥ng th·ªÉ ki·ªÉm so√°t ƒë∆∞·ª£c. Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi th·∫ø gi·ªõi th√∫ v·ªã c·ªßa kh√≥a nh√† cung c·∫•p!

 Mobiletto ƒë∆∞·ª£c thi·∫øt k·∫ø ƒë·ªÉ gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ n√†y. B·∫±ng c√°ch m√£ h√≥a ·ª©ng d·ª•ng c·ªßa b·∫°n th√†nh API c·ªßa mobiletto, b·∫°n c√≥ th·ªÉ d·ªÖ d√†ng
 thay ƒë·ªïi nh√† cung c·∫•p b·ªô nh·ªõ v√† bi·∫øt r·∫±ng l·ªõp l∆∞u tr·ªØ c·ªßa ·ª©ng d·ª•ng c·ªßa b·∫°n s·∫Ω ho·∫°t ƒë·ªông gi·ªëng h·ªát nhau.

 ### Th·ª≠ nghi·ªám r·ªông r√£i
 T·∫•t c·∫£ c√°c tr√¨nh ƒëi·ªÅu khi·ªÉn ƒë·ªÅu ƒë∆∞·ª£c ki·ªÉm tra h√†nh vi gi·ªëng h·ªát nhau v·ªõi h∆°n 60 b√†i ki·ªÉm tra cho m·ªói tr√¨nh ƒëi·ªÅu khi·ªÉn.
 Ch√∫ng t√¥i ki·ªÉm tra t·∫•t c·∫£ c√°c tr√¨nh ƒëi·ªÅu khi·ªÉn v·ªõi m·ªçi s·ª± k·∫øt h·ª£p c·ªßa:
 * M√£ h√≥a: c·∫£ b·∫≠t v√† t·∫Øt
 * Redis cache: c·∫£ ƒë∆∞·ª£c b·∫≠t v√† t·∫Øt

 C√°ch ti·∫øp c·∫≠n n√†y gi√∫p ch√∫ng t√¥i y√™n t√¢m r·∫±ng mobiletto s·∫Ω ho·∫°t ƒë·ªông gi·ªëng nhau b·∫•t k·ªÉ b·∫°n s·ª≠ d·ª•ng tr√¨nh ƒëi·ªÅu khi·ªÉn n√†o,
 v√† b·∫•t k·ªÉ b·∫°n c√≥ b·∫≠t b·ªô nh·ªõ ƒë·ªám v√† / ho·∫∑c m√£ h√≥a hay kh√¥ng.

 ### H·ªó tr·ª£ tr√¨nh ƒëi·ªÅu khi·ªÉn
 Tr√¨nh ƒëi·ªÅu khi·ªÉn l∆∞u tr·ªØ Mobiletto hi·ªán t·∫°i:
 * `s3` : Amazon S3
 * `b2` : Backblaze B2
 * `local` : h·ªá th·ªëng t·ªáp c·ª•c b·ªô

 * R·∫•t hoan ngh√™nh c√°c ƒë√≥ng g√≥p ƒë·ªÉ h·ªó tr·ª£ th√™m c√°c nh√† cung c·∫•p d·ªãch v·ª• l∆∞u tr·ªØ ƒë√°m m√¢y! *

 ## mobiletto-cli
 Mobiletto d·ª± ƒë·ªãnh s·∫Ω ƒë∆∞·ª£c s·ª≠ d·ª•ng nh∆∞ m·ªôt th∆∞ vi·ªán b·∫±ng m√£ JavaScript kh√°c.

 ƒê·ªÉ l√†m vi·ªác v·ªõi mobiletto t·∫°i d√≤ng l·ªánh, h√£y s·ª≠ d·ª•ng [mobiletto-cli](https://www.npmjs.com/package/mobiletto-cli)

 ## Ngu·ªìn
 * [mobiletto tr√™n GitHub](https://github.com/cobbzilla/mobiletto)
 * [mobiletto tr√™n npm](https://www.npmjs.com/package/mobiletto)

 ## H·ªó tr·ª£ v√† T√†i tr·ª£
 T√¥i ƒëang c·ªë g·∫Øng tr·ªü th√†nh m·ªôt nh√† ph√°t tri·ªÉn ph·∫ßn m·ªÅm ngu·ªìn m·ªü chuy√™n nghi·ªáp. T√¥i ƒë√£ l√†m vi·ªác ·ªü
 ng√†nh c√¥ng nghi·ªáp ph·∫ßn m·ªÅm trong nhi·ªÅu nƒÉm, t√¥i ƒë√£ th√†nh l·∫≠p c√°c c√¥ng ty th√†nh c√¥ng v√† b√°n ch√∫ng cho c√°c c√¥ng ty ƒë·∫°i ch√∫ng.
 G·∫ßn ƒë√¢y, t√¥i b·ªã m·∫•t vi·ªác v√† t√¥i kh√¥ng th·ª±c s·ª± c√≥ b·∫•t k·ª≥ c√¥ng vi·ªác n√†o kh√°c.

 V√¨ v·∫≠y, t√¥i s·∫Ω th·ª≠ vi·∫øt ph·∫ßn m·ªÅm h·ªØu √≠ch v√† xem n√≥ c√≥ ho·∫°t ƒë·ªông kh√¥ng

 N·∫øu b·∫°n th√≠ch s·ª≠ d·ª•ng ph·∫ßn m·ªÅm n√†y, t√¥i s·∫Ω r·∫•t bi·∫øt ∆°n v√¨
 nh·ªè nh·∫•t [ƒë√≥ng g√≥p h√†ng th√°ng qua Patreon](https://www.patreon.com/cobbzilla)

 *C·∫£m ∆°n b·∫°n!*

 ## C√†i ƒë·∫∑t
 C√†i ƒë·∫∑t b·∫±ng c√°ch s·ª≠ d·ª•ng `npm` `yarn` . B·∫°n c√≥ th·ªÉ mu·ªën phi√™n b·∫£n `lite` kh√¥ng bao g·ªìm t·∫•t c·∫£ c√°c
 c√°c t·ªáp README ƒë√£ d·ªãch:

    npm install mobiletto-lite
    yarn add mobiletto-lite

 N·∫øu b·∫°n th·ª±c s·ª± mu·ªën c√°c t·ªáp README ·ªü m·ªçi ng√¥n ng·ªØ, h√£y c√†i ƒë·∫∑t phi√™n b·∫£n ƒë·∫ßy ƒë·ªß:

    npm install mobiletto
    yarn add mobiletto

 ## B·∫Øt ƒë·∫ßu nhanh
 M·ªôt v√≠ d·ª• ng·∫Øn s·ª≠ d·ª•ng tr√¨nh ƒëi·ªÅu khi·ªÉn `s3` .

 M√£ n√†y s·∫Ω ch·∫°y t∆∞∆°ng t·ª± n·∫øu tr√¨nh ƒëi·ªÅu khi·ªÉn l√† `b2` `local` .

    const storage = require('mobiletto')
    const bucket = await storage.connect('s3', aws_key, aws_secret, {bucket: 'bk'})

    // list objects: returns array of metadata objects
    const listing = await bucket.list()
    const dirList = await bucket.list('some/dir/')
    const everything = await bucket.list('', {recursive: true})

    // write an entire file
    let bytesWritten = await bucket.writeFile('some/path', someBufferOfData)

    // write a file from a stream/generator
    bytesWritten = await bucket.write('some/path', streamOrGenerator)

    // read an entire file
    // returns null if an exception would otherwise be thrown
    const bufferOrNull = await bucket.safeReadFile('some/path')

    // stream-read a file, passing data to callback
    const bytesRead = await bucket.read('some/path', (chunk) => { ...do something with chunk... } )

    // remove a file, returns the path removed
    let removed = await bucket.remove('some/path') // removed is a string

    // remove a directory, returns array of paths removed
    removed = await bucket.remove('some/directory', {recursive: true}) // removed is now an array!

 ----
 ## C√°ch s·ª≠ d·ª•ng c∆° b·∫£n
 M·ªôt v√≠ d·ª• r·ªông h∆°n nhi·ªÅu, hi·ªÉn th·ªã h·∫ßu h·∫øt c√°c t√≠nh nƒÉng ƒë∆∞·ª£c cung c·∫•p:

    const { mobiletto } = require('mobiletto')

    // General usage
    const api = await mobiletto(driverName, key, secret, opts)

    // To use 'local' driver:
    // * key: base directory
    // * secret: ignored, can be null
    // * opts object:
    // * readOnly: optional, never change anything on the filesystem; default is false
    // * fileMode: optional, permissions used when creating new files, default is 0600. can be string or integer
    // * dirMode: optional, permissions used when creating new directories, default is 0700. can be string or integer
    const local = await mobiletto('local', '/home/ubuntu/tmp', null, {fileMode: 0o0600, dirMode: '0700'})

    // To use 's3' driver:
    // * key: AWS Access Key ID
    // * secret: AWS Secret Key
    // * opts object:
    // * readOnly: optional, never change anything on the bucket; default is false
    // * bucket: required, name of the S3 bucket
    // * region: optional, the AWS region to communicate with, default is us-east-1
    // * prefix: optional, all read/writes within the S3 bucket will be under this prefix
    // * delimiter: optional, directory delimiter, default is '/' (note: always '/' when encryption is enabled)
    const s3 = await mobiletto('s3', aws_key, aws_secret, {bucket: 'bk', region: 'us-east-1'})

    // To use 'b2' driver:
    // * key: Backblaze Key ID
    // * secret: Backblaze Application Key
    // * opts object:
    // * readOnly: optional, never change anything on the bucket; default is false
    // * bucket: required, the ID (**not the name**) of the B2 bucket
    // * prefix: optional, all read/writes within the B2 bucket will be under this prefix
    // * delimiter: optional, directory delimiter, default is '/' (note: always '/' when encryption is enabled)
    // * partSize: optional, large files will be split into chunks of this size when uploading
    const b3 = await mobiletto('b2', b2_key_id, b2_app_key, {bucket: 'bk', partSize: 10000000})

    // List files
    api.list() // --> returns an array of metadata objects

    // List files recursively
    api.list({ recursive: true })

    // List files in a directory
    const path = 'some/path'
    api.list(path)
    api.list(path, { recursive: true }) // also supports recursive flag

    // Visit files in a directory -- visitor function must be async
    api.list(path, { visitor: myAsyncFunc })
    api.list(path, { visitor: myAsyncFunc, recursive: true })

    // The `list` method throws MobilettoNotFoundError if the path does not exist
    // When you call `safeList` on a non-existent path, it returns an empty array
    api.safeList('/path/that/does/not/exist') // returns []
    
    // Read metadata for a file
    api.metadata(path) // returns metadata object

    // The `metadata` method throws MobilettoNotFoundError if the path does not exist
    // When you call `safeMetadata` on a non-existent path, it returns null
    api.safeMetadata('/tmp/does_not_exist') // returns null
    
    // Read a file
    // Provide a callback that writes the data someplace
    const callback = (chunk) => { ... write chunk somewhere ... }
    api.read(path, callback) // returns count of bytes read

    // Read an entire file at once
    const data = await api.readFile(path) // returns a byte Buffer of the file contents
    
    // Read an entire file at once
    // returns null if an exception would otherwise be thrown
    const bufferOrNull = await bucket.safeReadFile('some/path')

    // Write a file
    // Provide a generator function that yields chunks of data
    const generator = function* () {
      while ( ... more-data-to-return ... ) {
        data = ... load-data ...
        yield data
      }
    }
    local.api(path, generator) // returns count of bytes written

    // Write an entire file at once (convenience method)
    await api.writeFile(path, bufferOrString) // returns count of bytes written

    // Delete a file
    // Quiet param is optional (default false), when set errors will not be thrown if the path does not exist
    // Always returns a value or throws an error.
    // Return value may be a single string of the file removed, or an array of all files removed (driver-dependent)
    const quiet = true
    api.remove(path, {quiet}) // returns single path removed

    // Recursively delete a directory and do it quietly (do not report errors)
    const recursive = true
    const quiet = true
    api.remove(path, {recursive, quiet}) // returns array of paths removed

 ## Metadata
 L·ªánh `metadata` tr·∫£ v·ªÅ si√™u d·ªØ li·ªáu v·ªÅ m·ªôt m·ª•c nh·∫≠p h·ªá th·ªëng t·ªáp.
 T∆∞∆°ng t·ª± nh∆∞ v·∫≠y, gi√° tr·ªã tr·∫£ v·ªÅ t·ª´ l·ªánh `list` l√† m·ªôt m·∫£ng c√°c ƒë·ªëi t∆∞·ª£ng si√™u d·ªØ li·ªáu.

 M·ªôt ƒë·ªëi t∆∞·ª£ng si√™u d·ªØ li·ªáu tr√¥ng gi·ªëng nh∆∞ sau:

    {
      "name": "fully/qualified/path/to/file",
      "type": "entry-type",
      "size": size-in-bytes,
      "ctime": creation-time-epoch-millis,
      "mtime": modification-time-epoch-millis
    }

 Thu·ªôc t√≠nh `type` c√≥ th·ªÉ `file` , `dir` , `link` ho·∫∑c `special` .

 T√πy thu·ªôc v√†o lo·∫°i tr√¨nh ƒëi·ªÅu khi·ªÉn, l·ªánh `list` c√≥ th·ªÉ kh√¥ng tr·∫£ v·ªÅ t·∫•t c·∫£ c√°c tr∆∞·ªùng. Thu·ªôc t√≠nh `name` `type`
 n√™n lu√¥n lu√¥n c√≥ m·∫∑t. L·ªánh `metadata` ti·∫øp theo s·∫Ω tr·∫£ v·ªÅ t·∫•t c·∫£ c√°c thu·ªôc t√≠nh c√≥ s·∫µn.

 ## Ki·ªÉu nh·∫≠p thay th·∫ø
 Nh·∫≠p m√¥-ƒëun c√≥ ph·∫°m vi ƒë·∫ßy ƒë·ªß v√† s·ª≠ d·ª•ng ch·ª©c nƒÉng `connect` :

    const storage = require('mobiletto')
    const opts = {bucket: 'bk', region: 'us-east-1'}
    const s3 = await storage.connect('s3', aws_key, aws_secret, opts)
    const objectData = await s3.readFile('some/path')

 ## B·ªô nh·ªõ ƒë·ªám
 Mobiletto ho·∫°t ƒë·ªông t·ªët nh·∫•t v·ªõi b·ªô nh·ªõ ƒë·ªám <a href="https://redis.io">redis</a> .

 Mobiletto s·∫Ω c·ªë g·∫Øng k·∫øt n·ªëi v·ªõi phi√™n b·∫£n redis tr√™n 127.0.0.1:6379

 B·∫°n c√≥ th·ªÉ ghi ƒë√® m·ªôt trong hai c√°ch sau:
 * ƒê·∫∑t env var c·ªßa `MOBILETTO_REDIS_HOST` , mobiletto ƒë·ªÉ k·∫øt n·ªëi t·∫°i ƒë√¢y thay v√¨ localhost
 * ƒê·∫∑t var env `MOBILETTO_REDIS_PORT` , c·ªïng n√†y s·∫Ω ƒë∆∞·ª£c s·ª≠ d·ª•ng

 Mobiletto s·∫Ω l∆∞u tr·ªØ t·∫•t c·∫£ c√°c kh√≥a redis c·ªßa m√¨nh v·ªõi ti·ªÅn t·ªë `_mobiletto__` . B·∫°n c√≥ th·ªÉ thay ƒë·ªïi ƒëi·ªÅu n√†y
 b·∫±ng c√°ch ƒë·∫∑t var env `MOBILETTO_REDIS_PREFIX` .

 B·∫°n c≈©ng c√≥ th·ªÉ ƒë·∫∑t b·ªô nh·ªõ ƒë·ªám cho m·ªói k·∫øt n·ªëi b·∫±ng ƒë·ªëi t∆∞·ª£ng `opts.redisConfig` :

    const redisConfig = {
        enabled: true, // optional, default is true. if false other props are ignored
        host: '127.0.0.1',
        port: 6379,
        prefix: '_mobiletto__'
    }
    const opts = { redisConfig, bucket: 'bk', region: 'us-east-1' }
    const s3 = await storage.connect('s3', aws_key, aws_secret, opts)

 ### B·∫°n kh√¥ng mu·ªën redis v√†o b·ªô nh·ªõ ƒë·ªám?
 ƒê·ªÉ v√¥ hi·ªáu h√≥a: h√£y truy·ªÅn `enabled: false` v√†o ƒë·ªëi `opts.redisConfig` c·ªßa b·∫°n khi b·∫°n thi·∫øt l·∫≠p k·∫øt n·ªëi c·ªßa m√¨nh.

 Nh∆∞ ƒë√£ th·∫£o lu·∫≠n b√™n d∆∞·ªõi, vi·ªác t·∫Øt b·ªô nh·ªõ ƒë·ªám s·∫Ω c√≥ ·∫£nh h∆∞·ªüng x·∫•u ƒë·∫øn hi·ªáu su·∫•t v√† l√†m ph√°t sinh nhi·ªÅu y√™u c·∫ßu h∆°n
 v√†o b·ªô nh·ªõ m√† b·∫°n th·ª±c s·ª± c·∫ßn.

 ### H∆∞·ªõng d·∫´n l∆∞u v√†o b·ªô nh·ªõ ƒë·ªám
 ** B·ªô nh·ªõ ƒë∆∞·ª£c m√£ h√≥a **: b·ªô nh·ªõ ƒë∆∞·ª£c m√£ h√≥a ƒë·ªçc / ghi ch·ªâ ch·∫≠m h∆°n m·ªôt ch√∫t so v·ªõi b√¨nh th∆∞·ªùng,
 nh∆∞ng vi·ªác ƒëi·ªÅu h∆∞·ªõng xung quanh c√°c th∆∞ m·ª•c (m·ªôt s·ªë th·ª© l√†m ƒë∆∞·ª£c) kh√° t·ªën k√©m. S·ª≠ d·ª•ng b·ªô nh·ªõ ƒë·ªám redis
 s·∫Ω gi√∫p b·∫°n tƒÉng hi·ªáu su·∫•t ƒë√°ng k·ªÉ.

 B·ªô nh·ªõ ƒë·ªám m·∫∑c ƒë·ªãnh l√† an to√†n, nh∆∞ng kh√¥ng ho·∫°t ƒë·ªông t·ªët n·∫øu b·∫°n c√≥ nhi·ªÅu thao t√°c ghi / x√≥a.
 B·∫•t k·ª≥ thao t√°c ghi ho·∫∑c x√≥a n√†o ƒë·ªÅu l√†m m·∫•t hi·ªáu l·ª±c c·ªßa to√†n b·ªô b·ªô nh·ªõ cache, ƒë·∫£m b·∫£o c√°c l·∫ßn ƒë·ªçc ti·∫øp theo s·∫Ω th·∫•y
 nh·ªØng thay ƒë·ªïi m·ªõi nh·∫•t.

 ### C√¥ng c·ª• CLI
 N·∫øu b·∫°n ƒëang s·ª≠ d·ª•ng c√¥ng c·ª• CLI nh∆∞ [mobiletto-cli](https://www.npmjs.com/package/mobiletto-cli),
 ch·∫Øc ch·∫Øn b·∫°n s·∫Ω mu·ªën k√≠ch ho·∫°t b·ªô nh·ªõ cache redis, v√¨ n√≥ t·ªìn t·∫°i tr√™n c√°c l·ªánh g·ªçi c·ªßa l·ªánh `mo` .

 ## Ph·∫£n chi·∫øu

    // Copy a local filesystem mobiletto to S3
    s3.mirror(local)

    // Mirror a local subdirectory from one mobiletto to an S3 mobiletto, with it's own subdirectory
    local.mirror(s3, 'some/local-folder', 'some/s3-folder')

 L·ªánh `mirror` th·ª±c hi·ªán sao ch√©p m·ªôt l·∫ßn t·∫•t c·∫£ c√°c t·ªáp t·ª´ mobiletto n√†y sang mobiletto kh√°c.
 N√≥ kh√¥ng ch·∫°y b·∫•t k·ª≥ quy tr√¨nh n√†o ƒë·ªÉ duy tr√¨ g∆∞∆°ng theo th·ªùi gian. Ch·∫°y l·∫°i l·ªánh `mirror`
 ƒë·ªÉ ƒë·ªìng b·ªô h√≥a b·∫•t k·ª≥ t·ªáp n√†o b·ªã thi·∫øu.

 Gi√° tr·ªã tr·∫£ v·ªÅ t·ª´ `mirror` l√† m·ªôt ƒë·ªëi t∆∞·ª£ng ƒë∆°n gi·∫£n c√≥ b·ªô ƒë·∫øm cho s·ªë l∆∞·ª£ng t·ªáp ƒë√£ ƒë∆∞·ª£c th√†nh c√¥ng
 ƒë∆∞·ª£c ph·∫£n chi·∫øu v√† c√≥ bao nhi√™u t·ªáp c√≥ l·ªói:

    {
      success: count-of-files-mirrored,
      errors: count-of-files-with-errors
    }

 C·∫¢NH B√ÅO: Sao ch√©p c√°c t·∫≠p d·ªØ li·ªáu l·ªõn c√≥ th·ªÉ r·∫•t t·ªën th·ªùi gian v√† bƒÉng th√¥ng

 V·ªõi ng·ªØ nghƒ©a cu·ªôc g·ªçi `mirror` , ƒë√¥i khi c√≥ th·ªÉ kh√≥ hi·ªÉu ƒë·ªÉ hi·ªÉu ai l√†
 ng∆∞·ªùi ƒë·ªçc v√† ng∆∞·ªùi vi·∫øt. H√£y t∆∞·ªüng t∆∞·ª£ng n√≥ gi·ªëng nh∆∞ m·ªôt c√¢u l·ªánh g√°n: "mobiletto b√™n tr√°i"
 l√† th·ª© ƒë∆∞·ª£c g√°n cho (d·ªØ li·ªáu ƒë∆∞·ª£c ph·∫£n chi·∫øu ƒë∆∞·ª£c ghi) v√† "mobiletto b√™n ph·∫£i" (
 ƒë·ªëi s·ªë cho ph∆∞∆°ng th·ª©c `mirror` ) l√† gi√° tr·ªã ƒëang ƒë∆∞·ª£c g√°n (d·ªØ li·ªáu ƒë∆∞·ª£c nh√¢n b·∫£n ƒë∆∞·ª£c ƒë·ªçc).

 ## M√£ h√≥a minh b·∫°ch
 B·∫≠t m√£ h√≥a ph√≠a m√°y kh√°ch minh b·∫°ch:

    // Pass encryption parameters
    const encryption = {
      // key is required, must be >= 16 chars
      key: randomstring.generate(128),

      // optional, the default is to derive IV from key
      // when set, IV must be >= 16 chars
      iv: randomstring.generate(128),

      // optional, the default is aes-256-cbc
      algo: 'aes-256-cbc'
    }
    const api = await mobiletto(driverName, key, secret, opts, encryption)

    // Subsequent write operations will encrypt data (client side) when writing
    // Subsequent read operations will decrypt data (client side) when reading

 Chuy·ªán g√¨ ƒëang x·∫£y ra v·∫≠y? Th∆∞ m·ª•c "m·ª•c nh·∫≠p th∆∞ m·ª•c" (ch·ªâ th·ªã) ri√™ng bi·ªát (ƒë∆∞·ª£c m√£ h√≥a) theo d√µi nh·ªØng t·ªáp n√†o c√≥ trong ƒë√≥
 th∆∞ m·ª•c (hay c√≤n g·ªçi l√† th∆∞ m·ª•c ch·ªâ th·ªã).
 * L·ªánh `list` ƒë·ªçc c√°c t·ªáp m·ª•c nh·∫≠p th∆∞ m·ª•c, gi·∫£i m√£ t·ª´ng ƒë∆∞·ªùng d·∫´n ƒë∆∞·ª£c li·ªát k√™; sau ƒë√≥ tr·∫£ v·ªÅ si√™u d·ªØ li·ªáu cho t·ª´ng t·ªáp
 C√°c l·ªánh * `list` kh√¥ng hi·ªáu qu·∫£ h∆°n, ƒë·∫∑c bi·ªát l√† ƒë·ªëi v·ªõi c√°c th∆∞ m·ª•c c√≥ s·ªë l∆∞·ª£ng t·ªáp l·ªõn
 * L·ªánh `write` ghi c√°c t·ªáp ch·ªâ th·ªã trong m·ªói th∆∞ m·ª•c l·ªánh c·ªßa cha, m·ªôt c√°ch ƒë·ªá quy; sau ƒë√≥ ghi t·ªáp
 * C√°c l·ªánh `write` s·∫Ω ph·∫£i ghi O (N), v·ªõi N = ƒë·ªô s√¢u trong h·ªá th·ªëng ph√¢n c·∫•p th∆∞ m·ª•c
 * L·ªánh `remove` lo·∫°i b·ªè t·ªáp ch·ªâ th·ªã t∆∞∆°ng ·ª©ng v√† t·ªáp cha c·ªßa n√≥ n·∫øu tr·ªëng, m·ªôt c√°ch ƒë·ªá quy; sau ƒë√≥ x√≥a t·ªáp
 * C√°c l·ªánh `remove` kh√¥ng ƒë·ªá quy s·∫Ω ph·∫£i ch·ªãu O (N) l·∫ßn ƒë·ªçc v√† c√≥ kh·∫£ nƒÉng l√† nhi·ªÅu l·∫ßn x√≥a, v·ªõi N = ƒë·ªô s√¢u trong ph√¢n c·∫•p th∆∞ m·ª•c
 * C√°c l·ªánh `remove` ƒë·ªá quy tr√™n c√°c h·ªá th·ªëng t·ªáp l·ªõn v√† s√¢u c√≥ th·ªÉ t·ªën k√©m

 L∆∞u √Ω r·∫±ng ngay c·∫£ khi k√≠ch ho·∫°t m√£ h√≥a ph√≠a m√°y kh√°ch, k·∫ª th√π v·∫´n c√≥ kh·∫£ nƒÉng hi·ªÉn th·ªã ƒë·∫ßy ƒë·ªß ph√≠a m√°y ch·ªß ƒë∆∞·ª£c m√£ h√≥a c·ªßa b·∫°n
 b·ªô nh·ªõ, ngay c·∫£ khi kh√¥ng c√≥ kh√≥a, v·∫´n c√≥ th·ªÉ xem t·ªïng s·ªë th∆∞ m·ª•c v√† bao nhi√™u t·ªáp trong m·ªói th∆∞ m·ª•c v√† v·ªõi
 m·ªôt s·ªë n·ªó l·ª±c, kh√°m ph√° m·ªôt s·ªë ho·∫∑c t·∫•t c·∫£ c·∫•u tr√∫c t·ªïng th·ªÉ c·ªßa h·ªá th·ªëng ph√¢n c·∫•p th∆∞ m·ª•c.
 * L∆∞u √Ω: S·ª≠ d·ª•ng c·∫•u tr√∫c t∆∞∆°ng ƒë·ªëi ph·∫≥ng ƒë·ªÉ b·∫£o m·∫≠t t·ªët h∆°n. *
 ƒê·ªëi th·ªß s·∫Ω kh√¥ng bi·∫øt t√™n c·ªßa c√°c th∆∞ m·ª•c / t·ªáp tr·ª´ khi h·ªç c≈©ng bi·∫øt m√£ h√≥a c·ªßa b·∫°n
 ho·∫∑c ƒë√£ b·∫ª kh√≥a m√£ h√≥a th√†nh c√¥ng. T·∫•t c·∫£ c√°c c∆∞·ª£c ƒë√£ t·∫Øt sau ƒë√≥!

 ### Hi·ªáu su·∫•t v√† b·ªô nh·ªõ ƒë·ªám
 C√°c ho·∫°t ƒë·ªông tr√™n b·ªô nh·ªõ ƒë∆∞·ª£c m√£ h√≥a c√≥ th·ªÉ b·ªã ch·∫≠m. Danh s√°ch ƒë·ªá quy v√† x√≥a c√≥ th·ªÉ r·∫•t ch·∫≠m.
 B·ªô nh·ªõ ƒë·ªám th√¥ng qua redis gi√∫p √≠ch r·∫•t nhi·ªÅu, nh∆∞ng l∆∞u √Ω r·∫±ng b·ªô nh·ªõ ƒë·ªám ƒë∆∞·ª£c x√≥a khi b·∫•t k·ª≥ l·∫ßn ghi ho·∫∑c x√≥a n√†o.

 ## Xoay ph√≠m
 T·∫°o m·ªôt mobiletto b·∫±ng kh√≥a m·ªõi c·ªßa b·∫°n, sau ƒë√≥ sao ch√©p d·ªØ li·ªáu c≈© v√†o ƒë√≥:

    const storage = require('mobiletto')

    const oldEncryption = { key: .... }
    const oldStorage = await storage.connect('s3', aws_key, aws_secret, {bucket: 'bk', region: 'us-east-1'}, oldEncryption)

    const newEncryption = { key: .... }
    const newStorage = await storage.connect('s3', aws_key, aws_secret, {bucket: 'zz', region: 'us-east-1'}, newEncryption)

    newStorage.mirror(oldStorage) // if oldStorage is very large, this may take a looooooong time...

 ## Giao di·ªán tr√¨nh ƒëi·ªÅu khi·ªÉn
 Tr√¨nh ƒëi·ªÅu khi·ªÉn l√† b·∫•t k·ª≥ t·ªáp JS n√†o xu·∫•t m·ªôt h√†m 'storageClient' v·ªõi ch·ªØ k√Ω n√†y:

    function storageClient (key, secret, opts)

 * `key` : m·ªôt chu·ªói, kh√≥a API c·ªßa b·∫°n (ƒë·ªëi v·ªõi tr√¨nh ƒëi·ªÅu `local` , ƒë√¢y l√† th∆∞ m·ª•c c∆° s·ªü)
 * `secret` : m·ªôt chu·ªói, b√≠ m·∫≠t API c·ªßa b·∫°n (c√≥ th·ªÉ ƒë∆∞·ª£c b·ªè qua cho tr√¨nh ƒëi·ªÅu `local` )
 * `opts` : m·ªôt ƒë·ªëi t∆∞·ª£ng, c√°c thu·ªôc t√≠nh l√† tr√™n m·ªói tr√¨nh ƒëi·ªÅu khi·ªÉn:
 * ƒê·ªëi v·ªõi `local` , thu·ªôc `fileMode` v√† `dirMode` x√°c ƒë·ªãnh c√°ch t·∫°o c√°c t·ªáp v√† th∆∞ m·ª•c m·ªõi ƒë∆∞·ª£c t·∫°o
 * ƒê·ªëi v·ªõi `s3` , thu·ªôc `bucket` l√† b·∫Øt bu·ªôc. C√°c thu·ªôc t√≠nh t√πy ch·ªçn l√†:
    * `region`: the S3 region, default is us-east-1
    * `prefix`: a prefix to prepend to all S3 paths, default is the empty string
    * `delimiter`: the directory delimiter, default is '/'

 ƒê·ªëi t∆∞·ª£ng m√† h√†m StorageClient tr·∫£ v·ªÅ ph·∫£i x√°c ƒë·ªãnh c√°c h√†m n√†y:

    // Test the driver before using, ensure proper configuration
    async testConfig ()

    // List files in path (or from base-directory)
    // If recursive is true, list recursively
    // If visitor is defined, it will be an async function. await the visitor function on each file found
    // Otherwise, perform the listing and return an array of objects
    async list (path, recursive = false, visitor = null) // path may be omitted
    
    // Read metadata for a path
    async metadata (path)
    
    // Read a file
    // callback receives a chunk of data. endCallback is called at end-of-stream
    async read (path, callback, endCallback = null)

    // Write a file
    // driver must be able to handle a generator or a stream
    async write (path, generatorOrReadableStream)

    // Remove a file, or recursively delete a directory
    // returns a string of a single path removed, or an array of multiple paths removed
    async remove (path, recursive = false, quiet = false)

 ## Ghi nh·∫≠t k√Ω
 Mobiletto s·ª≠ d·ª•ng th∆∞ vi·ªán ghi nh·∫≠t k√Ω [wonton](https://www.npmjs.com/package/winston).

 Nh·∫≠t k√Ω ** s·∫Ω ** ch·ª©a ƒë∆∞·ªùng d·∫´n t·ªáp v√† th√¥ng b√°o l·ªói, nh∆∞ng s·∫Ω ** kh√¥ng bao gi·ªù ** ch·ª©a kh√≥a, b√≠ m·∫≠t,
 ho·∫∑c b·∫•t k·ª≥ th√¥ng tin c·∫•u h√¨nh k·∫øt n·ªëi n√†o kh√°c.

 ### M·ª©c ƒëƒÉng nh·∫≠p
 S·ª≠ d·ª•ng bi·∫øn m√¥i tr∆∞·ªùng `MOBILETTO_LOG_LEVEL` ƒë·ªÉ ƒë·∫∑t m·ª©c nh·∫≠t k√Ω, s·ª≠ d·ª•ng m·ªôt
 c·ªßa c√°c c·∫•p ƒë·ªô `npm` ƒë∆∞·ª£c x√°c ƒë·ªãnh trong [https://www.npmjs.com/package/winston#logging-levels](https://www.npmjs.com/package/winston#logging-levels)

 M·ª©c m·∫∑c ƒë·ªãnh l√† `error` . M·ª©c ƒë·ªô d√†i d√≤ng nh·∫•t l√† `silly` , m·∫∑c d√π hi·ªán t·∫°i l√† mobiletto
 kh√¥ng ƒëƒÉng nh·∫≠p ·ªü c√°c c·∫•p d∆∞·ªõi `debug`

    MOBILETTO_LOG_LEVEL=silly # maximum logs!

 ### T·ªáp nh·∫≠t k√Ω
 Theo m·∫∑c ƒë·ªãnh, tr√¨nh ghi nh·∫≠t k√Ω ghi v√†o b·∫£ng ƒëi·ªÅu khi·ªÉn. ƒê·ªÉ g·ª≠i nh·∫≠t k√Ω v√†o m·ªôt t·ªáp, h√£y ƒë·∫∑t `MOBILETTO_LOG_FILE`
 bi·∫øn m√¥i tr∆∞·ªùng. Khi ƒëƒÉng nh·∫≠p v√†o m·ªôt t·ªáp, nh·∫≠t k√Ω s·∫Ω kh√¥ng c√≤n ƒë∆∞·ª£c ghi v√†o b·∫£ng ƒëi·ªÅu khi·ªÉn.

    MOBILETTO_LOG_FILE=/var/my_mobiletto_log

 ƒê·ªÉ t·∫Øt ghi nh·∫≠t k√Ω:

    MOBILETTO_LOG_FILE=/dev/null

</pre>
